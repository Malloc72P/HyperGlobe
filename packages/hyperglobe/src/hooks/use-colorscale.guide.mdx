import { Meta, Title, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as ColorScaleStory from './use-colorscale.stories';

<Meta title="Hooks/ColorScale" of={ColorScaleStory} />

<Title>ColorScale</Title>
### 개요

`ColorScale`은 지도 데이터의 값에 따라 색을 다르게 적용할 수 있는 기능입니다.
이 기능을 사용하면 데이터에 기반한 시각적 표현을 쉽게 구현할 수 있습니다.

`HyperGlobe` 컴포넌트의 `colorscale` 속성을 통해 설정합니다.

### 기본 사용법

<Canvas of={ColorScaleStory.Basic} />

먼저 컬러스케일에서 사용할 데이터를 추가합니다.

```tsx
const [gdpData, setGdpData] = useState<any[]>([]);

useEffect(() => {
    fetch('/data/gdp-growth.json')
        .then((res) => res.json() as Promise<GdpGrowth[]>)
        .then(setGdpData);
}, []);

<HyperGlobe
  ...
  dataMap={{
    gdpGrowth: gdpData, // gdpData는 컬러스케일에서 사용할 데이터입니다.
  }}
  ...
/>
```

그 다음, 리젼 설정에서 `dataKey`와 `idField`를 지정합니다.
리젼 설정을 알아보기 전, 데이터 형식을 살펴보겠습니다.

### HGM 리젼 피쳐의 데이터 예시

```js
{
    "type": "Feature",
    "properties": {
        "id": "AF", // isoA2 코드
        "name": "Afghanistan",
        "isoA2": "AF",
        ...
    },
    ...
}
```

- 가장 많이 사용하는 국가별 세계지도(nations) HGM의 리젼 피쳐 예시입니다.
- 해당 HGM 리젼의 속성에는 id와 isoA2 코드가 포함되어 있습니다.
- 추가 데이터를 리젼에 연결하려면, 리젼 피쳐의 어떤 속성을 데이터의 id와 매칭할지 지정해야 합니다.
- 기본적으로 id 필드를 사용하지만, isoA2 코드로 매칭하고자 할 경우 `idField`를 `isoA2`로 지정할 수 있습니다.

### 리젼 설정에서 데이터 매칭하기

- 먼저 리젼에 연결할 추가 데이터의 형태를 살펴보겠습니다.

```js
[
  {
    key: 'AF',
    name: '아프가니스탄',
    'name-en': 'Afghanistan',
    value: 2.71088679128353,
  },
  {
    key: 'AL',
    name: '알바니아',
    'name-en': 'Albania',
    value: 3.93662525742167,
  },
];
```

- 우리는 `key` 필드를 통해 리젼 피쳐의 `isoA2` 속성과 데이터를 매칭하고자 합니다.
- 이를 위해 리젼 설정에서 `dataKey`, `idField`, `dataIdField`를 다음과 같이 지정합니다.

```tsx

<HyperGlobe
  ...
    region={{
        dataKey: 'gdpGrowth', // 리젼에서 사용할 추가 데이터에 대한 키
        idField: 'isoA2', // region feature의 id 매핑용 필드
        dataIdField: 'id', // data 항목의 id 필드
    }}
    ...
/>
```

- dataKey: `dataMap`에서 사용할 데이터의 키입니다.
- idField: 지도 피처의 속성 중 데이터와 매칭할 필드입니다
- dataIdField: 데이터 항목에서 id로 사용할 필드입니다.
  - 기본적으로 `id` 필드를 사용합니다만, 만약 데이터의 다른 속성을 아이디로 취급하여 리젼과 매칭하고자 할 경우 이 속성을 사용합니다.

### 컬러스케일 설정하기

```tsx
<HyperGlobe
    ...
    colorscale={{
        steps: [
            { to: -10, color: '#ff5757' },
            { from: -10, to: 0, color: '#ffc0c0' },
            { from: 0, to: 1, color: '#f2f6fc' },
            { from: 1, to: 3, color: '#c9dcf4' },
            { from: 3, to: 5, color: '#a4c6ec' },
            { from: 5, color: '#78a9e2' },
        ],
        nullColor: Colors.GRAY[3],
    }}
/>
```

- 컬러스케일은 `steps` 배열을 통해 값의 범위에 따른 색상을 지정합니다.
- `from`과 `to` 속성을 통해 값의 범위를 지정하고, `color` 속성으로 해당 범위에 적용할 색상을 설정합니다.
- `nullColor` 속성은 값이 없는 경우 적용할 기본 색상을 지정합니다.
